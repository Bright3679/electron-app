<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List App</title>
    <link rel="stylesheet" href="./src/style/index_css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <div class="todo-container">
      <header>
        <h1>Todo List</h1>
        <p id="user-name"></p>
        <p id="about">About</p>
      </header>
      <form id="todo-form">
        <input type="text" id="todo-input" placeholder="Add a new task" />
        <button type="submit">Add Task</button>
      </form>
      <div class="todo-list" id="todo-list"></div>
      <footer>
        <p id="subject">Todo List for:</p>
        <button type="button" id="show-button">Show your Todo-List</button>
        <button type="button" id="logout-btn">Logout</button>
        <button type="button" id="clear-all-btn">Clear All</button>
      </footer>
    </div>
    <script src="./src/js/indexRenderer/index.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const loginName = document.getElementById("user-name");
        const about = document.getElementById("about");
        const subject = document.getElementById("subject");

        const token = localStorage.getItem("token");
        const taskTopic = localStorage.getItem("taskTopic");

        about.addEventListener("click", function () {
          Swal.fire({
            title: "About",
            html: `
              <p>This application helps you manage your tasks efficiently.
              You can add, edit, complete, and delete tasks to stay organized.</p>
              <p>Developed by: Ujjwal Soni</p>
              <p>Version: 1.0.0</p>
              <p>GitHub: <a href="https://github.com/Bright3679/electron-app" target="_blank">https://github.com/Bright3679/electron-app</a></p>
            `,
            icon: "info",
            backdrop: false,
            confirmButtonText: "Close",
          });
        });

        subject.textContent = `Todo List for : ${taskTopic}`;

        function logout() {
          localStorage.removeItem("token");
          window.location.href = "./src/pages/login.html";
        }

        function checkTokenExpiration() {
          if (!token) {
            logout();
            return;
          }

          const payload = JSON.parse(atob(token.split(".")[1]));
          const expiration = payload.exp * 1000;

          if (Date.now() >= expiration) {
            alert("Your Session has expired!");
            logout();
          } else {
            loginName.textContent = `Welcome, ${payload.name}`;
          }
        }

        checkTokenExpiration();
      });
    </script>
  </body>
</html>
